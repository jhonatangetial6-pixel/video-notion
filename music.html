<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M√∫sica al gesto ‚Äî Notion compatible</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    html,body{
      margin:0;
      padding:0;
      width:100%;
      height:100%;
      font-family:Montserrat, sans-serif;
      overflow-x:hidden;
    }
    .seccion{display:flex;width:100%;height:100vh}
    .negro{background:#000;color:#fff;flex:0.3;display:flex;align-items:center;justify-content:center}
    .blanco{background:#fff;flex:0.7;display:flex;align-items:center;justify-content:center}
    .contenido{height:100vh;display:flex;align-items:center;justify-content:center;background:#f5f5f5}
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.85);
      color:#fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:20px;
      transition:opacity .4s;
    }
    .overlay.fade{opacity:0;pointer-events:none}
    .btn{margin-top:16px;padding:10px 18px;border-radius:8px;border:0;background:#fff;color:#000;cursor:pointer}
    .note{opacity:.85;margin-top:10px;font-size:.9rem;text-align:center}
  </style>
</head>
<body>
  <div class="overlay" id="overlay">
    <div>Despl√°zate, haz clic o toca para activar la m√∫sica üéµ</div>
    <button id="btn" class="btn">Activar sonido</button>
    <div class="note">(Funciona dentro de Notion embed: mueve la rueda, haz clic o toca)</div>
  </div>

  <div class="seccion">
    <div class="negro"><h1>Malla Ortogonal</h1></div>
    <div class="blanco"><p>70% blanco ¬∑ 30% negro</p></div>
  </div>

  <div class="contenido"><p>Despl√°zate o haz clic...</p></div>
  <div class="contenido" style="background:#ddd"><p>Secci√≥n adicional</p></div>

  <audio id="audioElem" loop preload="auto" crossorigin="anonymous">
    <source src="https://jhonatangetial6-pixel.github.io/video-notion/audio.mp3" type="audio/mpeg">
  </audio>

  <script>
  (function(){
    const audioElem = document.getElementById('audioElem');
    const overlay = document.getElementById('overlay');
    const btn = document.getElementById('btn');

    let started = false;
    let audioCtx, sourceNode, gainNode;

    function setupAudioContext() {
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      sourceNode = audioCtx.createMediaElementSource(audioElem);
      gainNode = audioCtx.createGain();
      gainNode.gain.value = 0;
      sourceNode.connect(gainNode).connect(audioCtx.destination);
    }

    function fadeIn(duration = 1.2) {
      if (!gainNode) { audioElem.volume = 1; return; }
      const now = audioCtx.currentTime;
      gainNode.gain.cancelScheduledValues(now);
      gainNode.gain.setValueAtTime(0.0001, now);
      gainNode.gain.exponentialRampToValueAtTime(1, now + duration);
    }

    async function startAudio() {
      if (started) return;
      setupAudioContext();

      try {
        if (audioCtx.state === 'suspended') await audioCtx.resume();
        await audioElem.play();
        fadeIn(1.0);
        overlay.classList.add('fade');
        setTimeout(()=> overlay.remove(), 500);
        started = true;
        console.log('üéµ M√∫sica iniciada');
      } catch (err) {
        console.warn('‚ùå Reproducci√≥n fallida:', err);
      }
    }

    const opts = { once: true, passive: true };

    // Estos eventos s√≠ funcionan dentro de Notion embeds
    btn.addEventListener('click', startAudio, opts);
    overlay.addEventListener('pointerdown', startAudio, opts);
    overlay.addEventListener('touchstart', startAudio, opts);
    overlay.addEventListener('wheel', startAudio, opts);
    overlay.addEventListener('mousewheel', startAudio, opts);

  })();
  </script>
</body>
</html>
